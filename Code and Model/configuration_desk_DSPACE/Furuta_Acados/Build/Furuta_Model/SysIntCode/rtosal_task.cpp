/****************************************************************************\ 
 *** 
 *** File                  : rtosal_task.cpp
 *** 
 *** Generated by dSPACE Tools.
 *** (c) Copyright 2013, dSPACE GmbH. All rights reserved.
\****************************************************************************/

#if !defined(RTOSAL_TASK_CPP_)
#  define    RTOSAL_TASK_CPP_


/* -- Include directives. -- */
#  include <DsApplicationInterface.h>
#  include "dssimengine_api.h"
#  include "rtosal_msg.h"
#  include "rtosal_taskap.h"
#  include "IOCode_Data.h"
#  include <dsrtt.h>
#  include "rtosal_task.h"

#  if defined(EXTERN_C_DECL)
#    undef EXTERN_C_DECL
#  endif
#  if defined(__cplusplus)
#    define EXTERN_C_DECL extern "C"
#  else
#    define EXTERN_C_DECL extern
#  endif


/* -- Defines and directives in module scope. After include directives. -- */
DS_DEFINE_TASK(DsCRtosAlPeriodic_Task_1);
DS_DEFINE_TASK(DsCRtosAlAcadosSourceTask);
DS_DEFINE_TASK(DsCRtosAlAcadosTrigger);
DS_DEFINE_TASK(DsCRtosAlTask_iAsynchronous_Function_);

/* -- Variable declarations in module scope. -- */
DsCTask* pRtosAlPeriodic_Task_1 = 0;
DsCTask* pRtosAlAcadosSourceTask = 0;
DsCTask* pRtosAlAcadosTrigger = 0;
DsCTask* pRtosAlTask_iAsynchronous_Function_ = 0;
DsCTimer* pRtosAlTimer_Periodic_Task_1 = 0;
DsCTimer* pRtosAlTimer_AcadosSourceTask = 0;

/* Task simulation time variable */
Float64 RtosAlTaskSimTime_Periodic_Task_1 = 0;
ULong64 StepCounter_Periodic_Task_1 = 0;

/* Task simulation time variable */
Float64 RtosAlTaskSimTime_AcadosSourceTask = 0;
ULong64 StepCounter_AcadosSourceTask = 0;

#ifdef TASK_ENABLE_PROFILING
DsTProfilerSource ProfilerSrc_RtosAlTask_01_TaskEntry;
DsTProfilerSource ProfilerSrc_Furuta_Model_DSRTMdlOutputs0;
DsTProfilerSource ProfilerSrc_Furuta_Model_DSRTMdlUpdate0;
DsTProfilerSource ProfilerSrc_RtosAlTask_01_TaskExit;
DsTProfilerSource ProfilerSrc_RtosAlTask_02_TaskEntry;
DsTProfilerSource ProfilerSrc_dsmpb_event_task_F_iTriggerEventPortSFcn_b_TID0_BT1;
DsTProfilerSource ProfilerSrc_RtosAlTask_02_TaskExit;
DsTProfilerSource ProfilerSrc_RtosAlTask_03_TaskEntry;
DsTProfilerSource ProfilerSrc_dsmpb_event_task_F_iTriggerEventPortSFcn_g_TID4_BT3;
DsTProfilerSource ProfilerSrc_RtosAlTask_03_TaskExit;
DsTProfilerSource ProfilerSrc_RtosAlfuruta_model_i1fc_97f5_7ffd89b6ed41_TaskEntry;
DsTProfilerSource ProfilerSrc_dsmpb_event_task_F_el_TriggerEventPortSFcn_TID3_BT2;
DsTProfilerSource ProfilerSrc_RtosAlfuruta_model_i41fc_97f5_7ffd89b6ed41_TaskExit;
DsTProfilerSource ProfilerSrc_pRtosAlPeriodic_Task_1_daqService_1;
#endif

/* -- Declarations of extern functions. -- */

 EXTERN_C_DECL void Furuta_Model_DSRTMdlOutputs0(
    void);

 EXTERN_C_DECL void Furuta_Model_DSRTMdlUpdate0(
    void);

 EXTERN_C_DECL void dsmpb_event_task_Furuta_Model_TriggerEventPortSFcn_b_TID0_BT1(
    void);

 EXTERN_C_DECL void dsmpb_event_task_Furuta_Model_TriggerEventPortSFcn_g_TID4_BT3(
    void);

 EXTERN_C_DECL void dsmpb_event_task_Furuta_Model_TriggerEventPortSFcn_TID3_BT2(
    void);

/* -- Declarations of module local functions. -- */

  void RtosAlHandleOverruns(
    DsCTask* pTask, int numberOfAcceptedOverruns);

/* -- Definitions of exported functions. -- */

  void
RtosAlDefaultDeadlineViolationHandler(
    DsTErrorList ErrorList, DsCTask* pTask) 
{
    SimEngineApplStop();
    DsCApplication* pAppl = SimEngineApplGet();
    char CallCounterStr[32];
    snprintf(CallCounterStr, 32, "%llu", pTask->getCallCounter());
    pAppl->errorMessage(RTOSAL_DEADLINE_VIOLATION, "%s%s%s", "Furuta_Model", pTask->getDescription(), CallCounterStr);

}

  void
RtosAlProfilerSourcesInitialization(
    ) 
{
#ifdef TASK_ENABLE_PROFILING
    ProfilerSrc_RtosAlTask_01_TaskEntry =  dsProfilerCreateSource("RtosAlTask_01_TaskEntry");
    ProfilerSrc_Furuta_Model_DSRTMdlOutputs0 =  dsProfilerCreateSource("Furuta_Model_DSRTMdlOutputs0");
    ProfilerSrc_Furuta_Model_DSRTMdlUpdate0 =  dsProfilerCreateSource("Furuta_Model_DSRTMdlUpdate0");
    ProfilerSrc_RtosAlTask_01_TaskExit =  dsProfilerCreateSource("RtosAlTask_01_TaskExit");
    ProfilerSrc_RtosAlTask_02_TaskEntry =  dsProfilerCreateSource("RtosAlTask_02_TaskEntry");
    ProfilerSrc_dsmpb_event_task_F_iTriggerEventPortSFcn_b_TID0_BT1 =  dsProfilerCreateSource("dsmpb_event_task_Furuta_Model_TriggerEventPortSFcn_b_TID0_BT1");
    ProfilerSrc_RtosAlTask_02_TaskExit =  dsProfilerCreateSource("RtosAlTask_02_TaskExit");
    ProfilerSrc_RtosAlTask_03_TaskEntry =  dsProfilerCreateSource("RtosAlTask_03_TaskEntry");
    ProfilerSrc_dsmpb_event_task_F_iTriggerEventPortSFcn_g_TID4_BT3 =  dsProfilerCreateSource("dsmpb_event_task_Furuta_Model_TriggerEventPortSFcn_g_TID4_BT3");
    ProfilerSrc_RtosAlTask_03_TaskExit =  dsProfilerCreateSource("RtosAlTask_03_TaskExit");
    ProfilerSrc_RtosAlfuruta_model_i1fc_97f5_7ffd89b6ed41_TaskEntry =  dsProfilerCreateSource("RtosAlfuruta_model_Task_6529a514_a319_41fc_97f5_7ffd89b6ed41_TaskEntry");
    ProfilerSrc_dsmpb_event_task_F_el_TriggerEventPortSFcn_TID3_BT2 =  dsProfilerCreateSource("dsmpb_event_task_Furuta_Model_TriggerEventPortSFcn_TID3_BT2");
    ProfilerSrc_RtosAlfuruta_model_i41fc_97f5_7ffd89b6ed41_TaskExit =  dsProfilerCreateSource("RtosAlfuruta_model_Task_6529a514_a319_41fc_97f5_7ffd89b6ed41_TaskExit");
    ProfilerSrc_pRtosAlPeriodic_Task_1_daqService_1 =  dsProfilerCreateSource("pRtosAlPeriodic_Task_1_daqService_1");
#endif

}

/* -- Definitions of module local functions. -- */

  void
DsCRtosAlPeriodic_Task_1::onRun(
    DsTErrorList ErrorList) 
{
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlTask_01_TaskEntry, UserTimespanStart , 0, 0);
#   endif
    RtosAlTask_01_TaskEntry();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlTask_01_TaskEntry, UserTimespanEnd , 0, 0);
#   endif

    DS_MODEL_ACCESS_WRITE(1,pRtosAlPeriodic_Task_1);
    dsrtt_script_service_pre_computation();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_Furuta_Model_DSRTMdlOutputs0, UserTimespanStart , 0, 0);
#   endif
    Furuta_Model_DSRTMdlOutputs0();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_Furuta_Model_DSRTMdlOutputs0, UserTimespanEnd , 0, 0);
#   endif
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_pRtosAlPeriodic_Task_1_daqService_1, UserTimespanStart , 0, 0);
#   endif
    pRtosAlPeriodic_Task_1->daqService(1);
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_pRtosAlPeriodic_Task_1_daqService_1, UserTimespanEnd , 0, 0);
#   endif

    DS_MODEL_ACCESS_READ(1,pRtosAlPeriodic_Task_1);
    dsrtt_script_service_post_computation();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_Furuta_Model_DSRTMdlUpdate0, UserTimespanStart , 0, 0);
#   endif
    Furuta_Model_DSRTMdlUpdate0();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_Furuta_Model_DSRTMdlUpdate0, UserTimespanEnd , 0, 0);
#   endif
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlTask_01_TaskExit, UserTimespanStart , 0, 0);
#   endif
    RtosAlTask_01_TaskExit();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlTask_01_TaskExit, UserTimespanEnd , 0, 0);
#   endif

}

  void
DsCRtosAlPeriodic_Task_1::onOverrun(
    DsTErrorList ErrorList) 
{
    DsCTask* pTask = DsCRtosAlPeriodic_Task_1::getInstance();
    RtosAlHandleOverruns(pTask, 0);

}

  void
DsCRtosAlAcadosSourceTask::onRun(
    DsTErrorList ErrorList) 
{
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlTask_02_TaskEntry, UserTimespanStart , 0, 0);
#   endif
    RtosAlTask_02_TaskEntry();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlTask_02_TaskEntry, UserTimespanEnd , 0, 0);
#   endif
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_dsmpb_event_task_F_iTriggerEventPortSFcn_b_TID0_BT1, UserTimespanStart , 0, 0);
#   endif
    dsmpb_event_task_Furuta_Model_TriggerEventPortSFcn_b_TID0_BT1();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_dsmpb_event_task_F_iTriggerEventPortSFcn_b_TID0_BT1, UserTimespanEnd , 0, 0);
#   endif
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlTask_02_TaskExit, UserTimespanStart , 0, 0);
#   endif
    RtosAlTask_02_TaskExit();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlTask_02_TaskExit, UserTimespanEnd , 0, 0);
#   endif

}

  void
DsCRtosAlAcadosSourceTask::onOverrun(
    DsTErrorList ErrorList) 
{
    DsCTask* pTask = DsCRtosAlAcadosSourceTask::getInstance();
    RtosAlHandleOverruns(pTask, 0);

}

  void
DsCRtosAlAcadosTrigger::onRun(
    DsTErrorList ErrorList) 
{
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlTask_03_TaskEntry, UserTimespanStart , 0, 0);
#   endif
    RtosAlTask_03_TaskEntry();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlTask_03_TaskEntry, UserTimespanEnd , 0, 0);
#   endif
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_dsmpb_event_task_F_iTriggerEventPortSFcn_g_TID4_BT3, UserTimespanStart , 0, 0);
#   endif
    dsmpb_event_task_Furuta_Model_TriggerEventPortSFcn_g_TID4_BT3();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_dsmpb_event_task_F_iTriggerEventPortSFcn_g_TID4_BT3, UserTimespanEnd , 0, 0);
#   endif
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlTask_03_TaskExit, UserTimespanStart , 0, 0);
#   endif
    RtosAlTask_03_TaskExit();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlTask_03_TaskExit, UserTimespanEnd , 0, 0);
#   endif

}

  void
DsCRtosAlAcadosTrigger::onOverrun(
    DsTErrorList ErrorList) 
{
    DsCTask* pTask = DsCRtosAlAcadosTrigger::getInstance();
    RtosAlHandleOverruns(pTask, 0);

}

  void
DsCRtosAlTask_iAsynchronous_Function_::onRun(
    DsTErrorList ErrorList) 
{
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlfuruta_model_i1fc_97f5_7ffd89b6ed41_TaskEntry, UserTimespanStart , 0, 0);
#   endif
    RtosAlfuruta_model_Task_6529a514_a319_41fc_97f5_7ffd89b6ed41_TaskEntry();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlfuruta_model_i1fc_97f5_7ffd89b6ed41_TaskEntry, UserTimespanEnd , 0, 0);
#   endif
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_dsmpb_event_task_F_el_TriggerEventPortSFcn_TID3_BT2, UserTimespanStart , 0, 0);
#   endif
    dsmpb_event_task_Furuta_Model_TriggerEventPortSFcn_TID3_BT2();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_dsmpb_event_task_F_el_TriggerEventPortSFcn_TID3_BT2, UserTimespanEnd , 0, 0);
#   endif
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlfuruta_model_i41fc_97f5_7ffd89b6ed41_TaskExit, UserTimespanStart , 0, 0);
#   endif
    RtosAlfuruta_model_Task_6529a514_a319_41fc_97f5_7ffd89b6ed41_TaskExit();
#   ifdef TASK_ENABLE_PROFILING
    dsProfilerWriteEvent(ProfilerSrc_RtosAlfuruta_model_i41fc_97f5_7ffd89b6ed41_TaskExit, UserTimespanEnd , 0, 0);
#   endif

}

  void
DsCRtosAlTask_iAsynchronous_Function_::onOverrun(
    DsTErrorList ErrorList) 
{
    DsCTask* pTask = DsCRtosAlTask_iAsynchronous_Function_::getInstance();
    RtosAlHandleOverruns(pTask, 0);

}

  void
RtosAlHandleOverruns(
    DsCTask* pTask, int numberOfAcceptedOverruns) 
{
    /* Value -1 of numberOfAcceptedOverruns represents positive infinity */ 
    if (numberOfAcceptedOverruns < 0)
    {
        return;
    }
    if (pTask->getOverrunCounter() > (unsigned int)numberOfAcceptedOverruns)
    {
        SimEngineApplStop();
        DsCApplication* pAppl = SimEngineApplGet();
        char CallCounterStr[32];
        snprintf(CallCounterStr, 32, "%llu", pTask->getCallCounter());
        pAppl->errorMessage(RTOSAL_TASK_OVERRUN, "%s%s%s%d", "Furuta_Model", pTask->getDescription(), CallCounterStr, numberOfAcceptedOverruns);
    }

}

#endif                                 /* RTOSAL_TASK_CPP_ */
/* [EOF] */
